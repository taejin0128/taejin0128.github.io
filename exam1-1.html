<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<link type="text/css" rel="stylesheet" href="css/stylesheet3.css"/>
		<script src="js/jquery.js"></script> 
    		<script type="text/javascript" src="d3/d3.v3.js"></script>
			
		<title> The number of IE students in the five universities </title>
	</head>
	
	<body>
		
		<div id="header">
			<h2> The number of IE students in different years for five universities </h2>
		</div>

		<div id = "graph"> 
			<p> The number of senior IE students in the five universities </p>
		</div>

		<div id="footer">
		</div>


		<script type="text/javascript">

			var tempdataset, tempdataset1;
			var dataset = [ , ];
			var dataset1 = [];
			var y = [];
			var datatext = ["University A", "University B", "University C", "University D", "University E"];

			var margin = {top: 20, right: 20, bottom: 200, left: 70},
				 	 w = 590 - margin.left - margin.right,
			         h = 820 - margin.top - margin.bottom;

			var color = d3.scale.ordinal()
    					.range(["#98abc5", "#8a89a6", "#7b6888", "#6b486b"]);


			var barPadding = 10;

			d3.json("data/exam1.json", function(error, data) {
				
				tempdataset = data[1];
				tempdataset1 = data[2];

				console.log(tempdataset);

				//Array for senior scores
				dataset[0,0] = +tempdataset["University A"];
				dataset[0,1] = +tempdataset["University B"];
				dataset[0,2] = +tempdataset["University C"];
				dataset[0,3] = +tempdataset["University D"];
				dataset[0,4] = +tempdataset["University E"];

				//Array for senior scores
				dataset[1,0] = +tempdataset1["University A"];
				dataset[1,1] = +tempdataset1["University B"];
				dataset[1,2] = +tempdataset1["University C"];
				dataset[1,3] = +tempdataset1["University D"];
				dataset[1,4] = +tempdataset1["University E"];

  				color.domain(d3.keys(data[0]).filter(function(key) { return key !== "Year"; }));

  				data.forEach(function(d) {
  					var y0 = 0;
  					var y1 = 0;

    				d.University = color.domain().map(function(name) { 
    					return {
    						name: name, 
    						y0: y0, 
    						y1: y0 += +d["University A"]
    					}; 
    				});

    				//d.total = d.University[d.University.length - 1].y1;
    				y0 = y1;

    				console.log(d.University);
    				//console.log(d.total);
  				});

				console.log(datatext);
				console.log(dataset);

				var x = d3.scale.ordinal()
					.domain(datatext)
					.rangeBands([0, w]);
				
				var y = d3.scale.linear()
					.domain([0,600])
				    .range([h, 0]);

				var xAxis = d3.svg.axis()
				    .scale(x)
				    .orient("bottom");		    

				var yAxis = d3.svg.axis()
				    .scale(y)
				    .orient("left");
			
			//Create SVG element for graph
			var svg = d3.select("#graph")
				.data(data)
				.append("svg")
				.attr("width", w + margin.left + margin.right)
				.attr("height", h + margin.top + margin.bottom)
				.append("g")
				.attr("transform", "translate(" + margin.left + "," + margin.top + ")");

				svg.selectAll("rect")
				    .data(function(d) { return d.University; })
				    .enter()
				    .append("rect")
				    .attr("x", function(d, i) {
				   		console.log(dataset.length);
				   		return i * (w / dataset.length);
				    })
      				.attr("y", function(d) { return y(d.y1); })
      				.attr("height", function(d) { 
      					console.log(y(d.y0) - y(d.y1));
      					return y(d.y0) - y(d.y1); 
      				})
				    .attr("width", w / dataset.length - barPadding)
				    .attr("fill", function(d) {
						return color(d.name);
				    });

				svg.append("g")
				    .attr("class", "x axis")
				    .attr("transform", "translate(0," + h + ")")
				    .call(xAxis)
				    .selectAll("text")
				    .attr("y", -6)
	    			    .attr("x", -20)
	    		    	    .attr("dx", "2em")
	    			    .attr("transform", "rotate(90)")
	    			    .style("text-anchor", "start");

				svg.append("g")
				    .attr("class", "y axis")
				    .call(yAxis)
			
			   });
			
		</script>
		
	</body>
</html>
